<!DOCTYPE html>
<meta charset="utf-8">
<link href="https://fonts.googleapis.com/css?family=Roboto|Roboto+Slab" rel="stylesheet">
  <head>
    <script type="text/javascript">
      // Your Client ID can be retrieved from your project in the Google
      // Developer Console, https://console.developers.google.com
      var CLIENT_ID = '499744196575-9uqbp59kv8pvsmg5g6u5s0ghfm2o48q0.apps.googleusercontent.com';

      var SCOPES = ["https://www.googleapis.com/auth/calendar"];

      /**
       * Check if current user has authorized this application.
       */
      function checkAuth() {
        gapi.auth.authorize(
          {
            'client_id': CLIENT_ID,
            'scope': SCOPES.join(' '),
            'immediate': true
          }, handleAuthResult);
      }

      /**
       * Handle response from authorization server.
       *
       * @param {Object} authResult Authorization result.
       */
      function handleAuthResult(authResult) {
        var authorizeDiv = document.getElementById('authorize-div');
        if (authResult && !authResult.error) {
          // Hide auth UI, then load client library.
          authorizeDiv.style.display = 'none';
          loadCalendarApi();
        } else {
          // Show auth UI, allowing the user to initiate authorization by
          // clicking authorize button.
          authorizeDiv.style.display = 'inline';
        }
      }

      /**
       * Initiate auth flow in response to user clicking authorize button.
       *
       * @param {Event} event Button click event.
       */
      function handleAuthClick(event) {
        gapi.auth.authorize(
          {client_id: CLIENT_ID, scope: SCOPES, immediate: false},
          handleAuthResult);
        return false;
      }

      /**
       * Load Google Calendar client library. List upcoming events
       * once client library is loaded.
       */
      function loadCalendarApi() {
        gapi.client.load('calendar', 'v3');
      }
	  
	  function quickAddRequest(element) {
		var request = gapi.client.calendar.events.quickAdd({
			'calendarId': 'primary',
			'text': $(element).text()
		});

		function handleResponse(response) {
			console.log(response)
			if (response.status == "confirmed"){
				element.className += " confirmed";
				confirmation = document.createElement("a");
				confirmation.className = "confirmation";
				confirmation.textContent = response.summary;
				confirmation.href = response.htmlLink;
				confirmation.contentEditable = false;
				element.appendChild(confirmation);
			}
		}
		request.execute(handleResponse);
	  }
	  


    </script>
    <script src="https://apis.google.com/js/client.js?onload=checkAuth">
    </script>
  </head>
<style type='text/css'>
.maineditor {
	font-family: 'Roboto', sans-serif;
	resize: none;
	width: 95%;
	height: 100%;
	//position:absolute;
	padding: 1em;
}

.note {
	background-color: rgba(0,0,0,.1);
	margin: 2px;
	border: dashed;
	border-color: #ddd;
	border-radius: .5em;
	border-width: 1px;
	padding: .3em;
	min-height: 1em;
	position: relative;
}

.note.confirmed {
	background-color: rgba(0,255,0,.1);
	margin: 2px;
	border: dashed;
	border-color: #ddd;
	border-radius: .5em;
	border-width: 1px;
	padding: .3em;
	min-height: 1em;
}

.note .confirmation {
	position: absolute;
	right: 0px;
	top: 0px;
	margin: 0px;
	opacity: .5;
}

body {
	margin: 0px;
}
</style>
<body>
 <div id="authorize-div" style="display: none">
      <span>Authorize access to Google Calendar API</span>
      <!--Button for the user to click to initiate auth sequence -->
      <button id="authorize-button" onclick="handleAuthClick(event)">
        Authorize
      </button>
    </div>
<div id="root">
	<div contenteditable="true" autofocus="true" class="maineditor" id="main"><div class="note"></div></div>
</div>

<script src="https://d3js.org/d3.v4.min.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script>
<script src="http://ichord.github.io/Caret.js/src/jquery.caret.js"></script>
<script>

$('#main').on('keydown', function (e) {
	var keyCode = e.keyCode || e.which;

	if (keyCode == 9 || keyCode == 13) {
		var sel = document.getSelection(),
		node = sel.anchorNode,
		element = node;
		if (element.nodeType == 3) {
			element = node.parentElement;
		}
		
		if (keyCode == 9) {
			e.preventDefault();
		
		} else  if (keyCode == 13) {
			quickAddRequest(element);
		}
		

	}

});

function showme() {
	return lines = $('#main').html();
}


</script>

</body>